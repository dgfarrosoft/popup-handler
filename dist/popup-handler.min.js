function PopupHandler(){return this instanceof PopupHandler?(this.triggerAttribute="data-popup",this.popupVisible=!1,this.additionalDataAttributes=[],this.deferredTriggerAttribute="data-deferred-popup",this.disabledFormClass="js-disabled",this.popupClass="b-popup",this.popupWrapperClass=this.popupClass+"__wrapper",this.popupCloseSelector="[data-popup-close]",this.popupContents={},this.popupHandlers={},this.focusOnFirstInput=!0,this.closeOnWrapperClick=!0,this.ajaxUrl="",this.ajaxRequestData={},this.animatedShow=!0,this.popupShowSpeed=200,this.backgroundTransition=!0,this.backgroundTransitionSpeed=1e3,this.darkBackground=!1,this.popupStyles="background-color:transparent;text-align:center;position:fixed;z-index:100;display:none;height: 100%;width: 100%;left:0;top:0;",this.init=function(t){if(void 0!==t)for(var i in t)this[i]=t[i];this.getPopupsContent(),this.injectPopup(),this.setPopupStyles(),this.initEventListeners()},this.getPopupsContent=function(){var t=this,i=this.getAjaxRequestData(),p=this.isEqual(i,this.ajaxRequestData);this.ajaxRequestData=i,0===Object.keys(i.popupRequestData).length||""==this.ajaxUrl||p||jQuery.ajax({url:this.ajaxUrl,type:"POST",data:i,success:function(i){if("no content"!=i){i=jQuery.parseJSON(i);for(var p in i)t.popupContents[p]={formID:i[p].formID,content:i[p].content}}else console.log(i)},error:function(t){console.log(t)}})},this.fillPopup=function(t){var i=this;this.popup.html(this.popupContents[t].content),this.getPopupsContent(),void 0!==this.popupHandlers[t]&&"function"==typeof this.popupHandlers[t]&&jQuery("form#"+this.popupContents[t].formID).submit(function(p){p.preventDefault();var s=jQuery(this);s.hasClass(i.disabledFormClass)||i.formSubmission(i,t,s)})},this.formSubmission=function(t,i,p){this.popupHandlers[i](p,t)},this.showPopup=function(t,i){if("string"!=typeof t){i=void 0===i?!1:i;var p=i?this.deferredTriggerAttribute:this.triggerAttribute;t=t.attr(p)}this.hidePopup(!0),void 0!==this.popupContents[t]?""!=this.popupContents[t].formID&&(this.fillPopup(t),this.popupVisible=!0,jQuery(document).trigger("popup-show",[this.popup]),this.popupWrapper.show(),this.centerVertically(),void 0!==this.customWrapperBackground?this.popupWrapper.css("background-color",this.customWrapperBackground):this.darkBackground?this.popupWrapper.css("background-color","rgba(1, 1, 1, .7)"):this.popupWrapper.css("background-color","rgba(207, 207, 207, .6)"),this.focusOnFirstInput&&this.popup.find("input").eq(0).focus()):(console.log("showPopup"),console.log(t))},this.hidePopup=function(){this.popupWrapper.css("-webkit-transition","none"),this.popupWrapper.css("transition","none"),this.popupWrapper.css("padding-top",0),this.popupWrapper.hide(),this.popup.html(""),this.setPopupStyles(),this.popupVisible||this.popupWrapper.css("background-color","transparent"),this.popupVisible=!1},this.getSingleAjaxRequestData=function(t,i){void 0===i&&(i={});var p,s=0;if(0!=this.additionalDataAttributes.length)for(var e=0;e<this.additionalDataAttributes.length;e++)p=t.attr(this.additionalDataAttributes[e]),void 0!==p&&(i=0==i?{}:i,i[this.additionalDataAttributes[e]]=p,s++),e==this.additionalDataAttributes.length-1&&0==s&&(i=0);else i=0;return i},this.getAjaxRequestData=function(){var t={action:"ajaxGetPopupContent",popupRequestData:{}},i=jQuery("["+this.triggerAttribute+"]"),p=jQuery("["+this.deferredTriggerAttribute+"]");return t=this.fillRequestData(i,t),t=this.fillRequestData(p,t,!0)},this.fillRequestData=function(t,i,p){void 0===p&&(p=!1);for(var s,e,o=p?this.deferredTriggerAttribute:this.triggerAttribute,r=0;r<t.length;r++)e=jQuery(t[r]),s=e.attr(o),void 0!=s&&(i.popupRequestData[s]=this.getSingleAjaxRequestData(e,i.popupRequestData[s]));return i},this.updateContent=function(t,i){if(void 0!==this.popupContents[t]){var p=document.createElement("div");p.innerHTML=this.popupContents[t].content;var s=jQuery(p);jQuery.each(i,function(t,i){i(s.find(t),s)}),this.popupContents[t].content=p.innerHTML}else console.log("no content")},this.injectPopup=function(){0==jQuery("."+this.popupClass).length&&jQuery("body").append('<div class = "'+this.popupWrapperClass+'"><div class = "'+this.popupClass+'__close-btn"></div><div class = "'+this.popupClass+'"></div></div>'),this.popup=jQuery("."+this.popupClass),this.popupWrapper=this.popup.closest("."+this.popupWrapperClass)},this.initEventListeners=function(){var t=this;jQuery(document).on("click","["+this.triggerAttribute+"]",function(i){i.preventDefault(),t.showPopup(jQuery(this).attr(t.triggerAttribute)),jQuery(t.popupCloseSelector).click(function(){t.hidePopup()}),t.closeOnWrapperClick&&jQuery(document).click(function(i){jQuery(i.target).hasClass(t.popupWrapperClass)&&t.hidePopup()})})},this.centerVertically=function(){var t=this.popupWrapper,i=(t.outerHeight()-this.popup.outerHeight())/2;t.css("padding-top",i)},this.isEqual=function(t,i){return JSON.stringify(t)===JSON.stringify(i)},this.setPopupStyles=function(){var t=[];this.popupWrapper.attr("style",this.popupStyles),this.animatedShow&&t.push("padding "+this.popupShowSpeed/1e3+"s"),this.backgroundTransition&&t.push("background-color "+this.backgroundTransitionSpeed/1e3+"s"),t=t.join(","),""!=t&&this.popupWrapper.css("transition",t)},void 0):new PopupHandler}