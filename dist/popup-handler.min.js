function PopupHandler(){return this instanceof PopupHandler?(this.triggerAttribute="data-popup",this.deferredTriggerAttribute="data-deferred-popup",this.contentAttribute="data-content",this.additionalDataAttributes=[],this.getFromPage=[],this.popupClass="b-popup",this.popupWrapperClass=this.popupClass+"__wrapper",this.popupCloseButtonClass=this.popupClass+"__close-btn",this.popupCloseSelectors=["[data-popup-close]","."+this.popupCloseButtonClass],this.disabledFormClass="js-disabled",this.popupHandlers={},this.popupVisible=!1,this.popupContents={},this.focusOnFirstInput=!0,this.closeOnWrapperClick=!0,this.ajaxUrl="",this.ajaxRequestData={},this.animatedShow=!0,this.popupShowSpeed=200,this.backgroundTransition=!0,this.backgroundTransitionSpeed=1e3,this.darkBackground=!1,this.ajaxAction="",this.ajaxDataObjectName="popupRequestData",this.customWrapperBackground="",this.closeButtonSize="40px",this.closeButtonColor="#000",this.popupStyles="background:transparent;text-align:center;position:fixed;z-index:100;display:none;height: 100%;width: 100%;left:0;top:0;",this.popupCloseImage='<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 371.23 371.23" style="enable-background:new 0 0 371.23 371.23;" xml:space="preserve"><polygon points="371.23,21.213 350.018,0 185.615,164.402 21.213,0 0,21.213 164.402,185.615 0,350.018 21.213,371.23 185.615,206.828 350.018,371.23 371.23,350.018 206.828,185.615 "/><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g></svg>',this.popupCloseBtnStyles="width: "+this.closeButtonSize+";height: "+this.closeButtonSize+";position: absolute;right: 2%;top: 2%;cursor: pointer;",this.init=function(t){if(void 0!==t)for(var p in t)this[p]=t[p];this.getPopupsContent(),this.injectPopup(),this.popupCloseBtn=$("."+this.popupCloseButtonClass),this.setPopupStyles(),this.initEventListeners()},this.getPopupsContent=function(){var t=this,p=this.getAjaxRequestData(),s=this.isEqual(p,this.ajaxRequestData);this.ajaxRequestData=p,0===Object.keys(p[this.ajaxDataObjectName]).length||""===this.ajaxUrl||s||jQuery.ajax({url:this.ajaxUrl,type:"POST",data:p,success:function(p){if("no content"!==p){p=jQuery.parseJSON(p);for(var s in p)t.popupContents[s]={popupID:p[s].formID,content:p[s].content},t.popupContents[s].popupID=void 0===t.popupContents[s].popupID?s:t.popupContents[s].popupID}else console.log(p)},error:function(t){console.log(t)}})},this.fillPopup=function(t){var p=this;this.popup.html(this.popupContents[t].content),this.getPopupsContent(),void 0!==this.popupHandlers[t]&&"function"==typeof this.popupHandlers[t]&&0!==jQuery("form#"+this.popupContents[t].popupID).length&&jQuery("form#"+this.popupContents[t].popupID).submit(function(s){s.preventDefault();var i=jQuery(this);i.hasClass(p.disabledFormClass)||p.formSubmission(p,t,i)})},this.formSubmission=function(t,p,s){this.popupHandlers[p](s,t)},this.showPopup=function(t,p){if("string"!=typeof t){p=void 0===p?!1:p;var s=p?this.deferredTriggerAttribute:this.triggerAttribute;t=t.attr(s)}this.hidePopup(!0),void 0!==this.popupContents[t]?""!==this.popupContents[t].popupID&&(this.fillPopup(t),this.popupVisible=!0,jQuery(document).trigger("popup-show",[this.popup]),this.popupWrapper.show(),this.centerVertically(),""!==this.customWrapperBackground?this.popupWrapper.css("background",this.customWrapperBackground):this.darkBackground?this.popupWrapper.css("background","rgba(1, 1, 1, .7)"):this.popupWrapper.css("background","rgba(207, 207, 207, .6)"),this.focusOnFirstInput&&this.popup.find("input").eq(0).focus()):(console.log("showPopup"),console.log(t))},this.hidePopup=function(){this.popupWrapper.css("-webkit-transition","none"),this.popupWrapper.css("transition","none"),this.popupWrapper.css("padding-top",0),this.popupWrapper.hide(),this.popup.html(""),this.setPopupStyles(),this.popupVisible||this.popupWrapper.css("background","transparent"),this.popupVisible=!1},this.getSingleAjaxRequestData=function(t,p){void 0===p&&(p={});var s,i=0;if(0!==this.additionalDataAttributes.length)for(var e=0;e<this.additionalDataAttributes.length;e++)s=t.attr(this.additionalDataAttributes[e]),void 0!==s&&(p=0===p?{}:p,p[this.additionalDataAttributes[e]]=s,i++),e===this.additionalDataAttributes.length-1&&0===i&&(p=0);else p=0;return p},this.getAjaxRequestData=function(){var t={};t[this.ajaxDataObjectName]={},""!==this.ajaxAction&&(t.action=this.ajaxAction);var p=jQuery("["+this.triggerAttribute+"]"),s=jQuery("["+this.deferredTriggerAttribute+"]");return t=this.fillRequestData(p,t),t=this.fillRequestData(s,t,!0)},this.fillRequestData=function(t,p,s){void 0===s&&(s=!1);for(var i,e,o=s?this.deferredTriggerAttribute:this.triggerAttribute,n=0;n<t.length;n++)e=jQuery(t[n]),i=e.attr(o),void 0!==i&&-1===this.getFromPage.indexOf(i)?p[this.ajaxDataObjectName][i]=this.getSingleAjaxRequestData(e,p[this.ajaxDataObjectName][i]):-1!==this.getFromPage.indexOf(i)&&(this.popupContents[i]={popupID:i,content:jQuery("["+this.contentAttribute+"="+i+"]").html()});return p},this.updateContent=function(t,p){if(void 0!==this.popupContents[t]){var s=document.createElement("div");s.innerHTML=this.popupContents[t].content;var i=jQuery(s);jQuery.each(p,function(t,p){p(i.find(t),i)}),this.popupContents[t].content=s.innerHTML}else console.log("no content")},this.injectPopup=function(){var t='<div class = "'+this.popupCloseButtonClass+'">'+this.popupCloseImage+"</div>";0===jQuery("."+this.popupClass).length&&jQuery("body").append('<div class = "'+this.popupWrapperClass+'">'+t+'<div class = "'+this.popupClass+'"></div></div>'),this.popup=jQuery("."+this.popupClass),this.popupWrapper=this.popup.closest("."+this.popupWrapperClass)},this.initEventListeners=function(){var t=this;jQuery(document).on("click","["+this.triggerAttribute+"]",function(p){p.preventDefault(),t.showPopup(jQuery(this).attr(t.triggerAttribute)),"string"==typeof t.popupCloseSelectors&&(t.popupCloseSelectors=[t.popupCloseSelectors]),jQuery(t.popupCloseSelectors.join(",")).click(function(){t.hidePopup()}),t.closeOnWrapperClick&&jQuery(document).click(function(p){jQuery(p.target).hasClass(t.popupWrapperClass)&&t.hidePopup()})})},this.centerVertically=function(t){var p=this.popupWrapper,s=(p.outerHeight()-this.popup.outerHeight())/2;p.css("padding-top",s)},this.isEqual=function(t,p){return JSON.stringify(t)===JSON.stringify(p)},this.setPopupStyles=function(){var t=[];this.popupWrapper.attr("style",this.popupStyles),this.popupCloseBtn.attr("style",this.popupCloseBtnStyles),this.popupCloseBtn.css("fill",this.closeButtonColor),this.animatedShow&&t.push("padding "+this.popupShowSpeed/1e3+"s"),this.backgroundTransition&&t.push("background "+this.backgroundTransitionSpeed/1e3+"s"),t=t.join(","),""!==t&&this.popupWrapper.css("transition",t)},void 0):new PopupHandler}