function PopupHandler(){this.triggerAttribute="data-popup",this.deferredTriggerAttribute="data-deferred-popup",this.disabledFormClass="js-disabled",this.popupClass="b-popup",this.popupWrapperClass=this.popupClass+"__wrapper",this.popupCloseSelector="[data-popup-close]",this.popupContents={},this.popupHandlers={},this.focusOnFirstInput=!0,this.closeOnWrapperClick=!0,this.init=function(t){void 0!==t&&(this.popupHandlers=t.popupHandlers,void 0!==t.additionalDataAttributes&&(this.additionalDataAttributes=t.additionalDataAttributes),this.triggerAttribute=void 0===t.triggerAttribute?this.triggerAttribute:t.triggerAttribute,this.deferredTriggerAttribute=void 0===t.deferredTriggerAttribute?this.deferredTriggerAttribute:t.deferredTriggerAttribute,this.disabledFormClass=void 0===t.disabledFormClass?this.disabledFormClass:t.disabledFormClass,this.popupClass=void 0===t.popupClass?this.popupClass:t.popupClass,this.focusOnFirstInput=void 0===t.focusOnFirstInput?this.focusOnFirstInput:t.focusOnFirstInput,this.popupCloseSelector=void 0===t.popupCloseSelector?this.popupCloseSelector:t.popupCloseSelector,this.closeOnWrapperClick=void 0===t.closeOnWrapperClick?this.closeOnWrapperClick:t.closeOnWrapperClick),this.getPopupsContent(this.triggerAttribute),this.injectPopup(),this.initEventListeners()},this.getPopupsContent=function(){var t=this,i=this.getAjaxRequestData();0!==Object.keys(i.popupRequestData).length&&$.ajax({url:themeVars.ajaxUrl,type:"POST",data:i,success:function(i){if("no content"!=i){i=$.parseJSON(i);for(var s in i)t.popupContents[s]={formID:i[s].formID,content:i[s].content}}else console.log(i)},error:function(t){console.log(t)}})},this.fillPopup=function(t){var i=this;this.popup.html(this.popupContents[t].content),this.getPopupsContent(),$("form#"+this.popupContents[t].formID).submit(function(s){s.preventDefault();var e=$(this);e.hasClass(i.disabledFormClass)||i.formSubmission(i,t,e)})},this.formSubmission=function(t,i,s){void 0!==this.popupHandlers[i]?this.popupHandlers[i](s,t):(console.log("formSubmission-default"),console.log(i))},this.showPopup=function(t,i){if("string"!=typeof t){i=void 0===i?!1:i;var s=i?this.deferredTriggerAttribute:this.triggerAttribute;t=t.attr(s)}this.hidePopup(),void 0!==this.popupContents[t]?""!=this.popupContents[t].formID&&(this.fillPopup(t),$(document).trigger("popup-show",[this.popup]),this.popup.parent().show(),centerVertically(this.popup),this.focusOnFirstInput&&this.popup.find("input").eq(0).focus()):(console.log("showPopup"),console.log(t))},this.hidePopup=function(){this.popup.parent().css("padding-top",0),$(document).trigger("popup-hide",[this.popup]),this.popup.parent().hide(),this.popup.html("")},this.getSingleAjaxRequestData=function(t,i){void 0===i&&(i={});var s,e=0;if(void 0!==this.additionalDataAttributes)for(var p=0;p<this.additionalDataAttributes.length;p++)s=t.attr(this.additionalDataAttributes[p]),void 0!==s&&(i[this.additionalDataAttributes[p]]=s,e++),p==this.additionalDataAttributes.length-1&&0==e&&(i=0);return i},this.getAjaxRequestData=function(){var t={action:"ajaxGetPopupContent",popupRequestData:{}},i=$("["+this.triggerAttribute+"]"),s=$("["+this.deferredTriggerAttribute+"]");return t=this.fillRequestData(t,i),t=this.fillRequestData(t,s,!0)},this.fillRequestData=function(t,i,s){void 0===s&&(s=!1);for(var e,p,o=s?this.deferredTriggerAttribute:this.triggerAttribute,r=0;r<i.length;r++)p=$(i[r]),e=p.attr(o),this.popupContents[e]||void 0==e||(t.popupRequestData[e]=this.getSingleAjaxRequestData(p,t[e]));return t},this.updateContent=function(t,i){if(void 0!==this.popupContents[t]){var s=document.createElement("div");s.innerHTML=this.popupContents[t].content;var e=$(s);$.each(i,function(t,i){i(e.find(t),e)}),this.popupContents[t].content=s.innerHTML}else console.log("no content")},this.injectPopup=function(){0==$("."+this.popupClass).length&&$("body").append('<div class = "'+this.popupWrapperClass+'"><div class = "'+this.popupClass+'__close-btn"></div><div class = "'+this.popupClass+'"></div></div>'),this.popup=$("."+this.popupClass)},this.initEventListeners=function(){var t=this;$(document).on("click","["+this.triggerAttribute+"]",function(i){i.preventDefault(),t.showPopup($(this).attr(t.triggerAttribute)),$(t.popupCloseSelector).click(function(){t.hidePopup()}),t.closeOnWrapperClick&&$(document).click(function(i){$(i.target).hasClass(t.popupWrapperClass)&&t.hidePopup()})})}}