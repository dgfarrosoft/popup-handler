function PopupHandler(){this.triggerAttribute="data-popup",this.deferredTriggerAttribute="data-deferred-popup",this.disabledFormClass="js-disabled",this.popupSelector=".b-popup",this.popupContents={},this.popupHandlers={},this.focusOnFirstInput=!0,this.init=function(t){void 0!==t&&(this.popupHandlers=t.popupHandlers,void 0!==t.additionalDataAttributes&&(this.additionalDataAttributes=t.additionalDataAttributes),this.triggerAttribute=void 0===t.triggerAttribute?this.triggerAttribute:t.triggerAttribute,this.deferredTriggerAttribute=void 0===t.deferredTriggerAttribute?this.deferredTriggerAttribute:t.deferredTriggerAttribute,this.disabledFormClass=void 0===t.disabledFormClass?this.disabledFormClass:t.disabledFormClass,this.popupSelector=void 0===t.popupSelector?this.popupSelector:t.popupSelector,this.focusOnFirstInput=void 0===t.focusOnFirstInput?this.focusOnFirstInput:t.focusOnFirstInput),this.popup=$(this.popupSelector),this.getPopupsContent(this.triggerAttribute)},this.getPopupsContent=function(){var t=this,e=this.getAjaxRequestData();0!==Object.keys(e.popupRequestData).length&&$.ajax({url:themeVars.ajaxUrl,type:"POST",data:e,success:function(e){if("no content"!=e){e=$.parseJSON(e);for(var i in e)t.popupContents[i]={formID:e[i].formID,content:e[i].content}}else console.log(e)},error:function(t){console.log(t)}})},this.fillPopup=function(t){var e=this;this.popup.html(this.popupContents[t].content),this.getPopupsContent(),$("form#"+this.popupContents[t].formID).submit(function(i){i.preventDefault();var s=$(this);s.hasClass(e.disabledFormClass)||e.formSubmission(e,t,s)})},this.formSubmission=function(t,e,i){void 0!==this.popupHandlers[e]?this.popupHandlers[e](i,t):(console.log("formSubmission-default"),console.log(e))},this.showPopup=function(t,e){e=void 0===e?!1:e;var i=e?this.deferredTriggerAttribute:this.triggerAttribute,s=t.attr(i);this.hidePopup(),void 0!==this.popupContents[s]?""!=this.popupContents[s].formID&&(this.fillPopup(s),$("body").addClass("element--overflow-hidden"),$(".b-site-content").addClass("element--unfocused"),this.popup.parent().addClass("element--visible"),centerVertically(this.popup),this.focusOnFirstInput&&this.popup.find("input").eq(0).focus()):(console.log("showPopup"),console.log(s))},this.hidePopup=function(){this.popup.parent().css("padding-top",0),$("body").removeClass("element--overflow-hidden"),$(".b-site-content").removeClass("element--unfocused"),this.popup.parent().removeClass("element--visible"),this.popup.html("")},this.getSingleAjaxRequestData=function(t,e){void 0===e&&(e={});var i,s=0;if(void 0!==this.additionalDataAttributes)for(var o=0;o<this.additionalDataAttributes.length;o++)i=t.attr(this.additionalDataAttributes[o]),void 0!==i&&(e[this.additionalDataAttributes[o]]=i,s++),o==this.additionalDataAttributes.length-1&&0==s&&(e=0);return e},this.getAjaxRequestData=function(){var t={action:"ajaxGetPopupContent",popupRequestData:{}},e=$("["+this.triggerAttribute+"]"),i=$("["+this.deferredTriggerAttribute+"]");return t=this.fillRequestData(t,e),t=this.fillRequestData(t,i,!0)},this.fillRequestData=function(t,e,i){void 0===i&&(i=!1);for(var s,o,n=i?this.deferredTriggerAttribute:this.triggerAttribute,r=0;r<e.length;r++)o=$(e[r]),s=o.attr(n),this.popupContents[s]||void 0==s||(t.popupRequestData[s]=this.getSingleAjaxRequestData(o,t[s]));return t},this.updateContent=function(t,e){if(void 0!==this.popupContents[t]){var i=document.createElement("div");i.innerHTML=this.popupContents[t].content;var s=$(i);$.each(e,function(t,e){e(s.find(t),s)}),this.popupContents[t].content=i.innerHTML}else console.log("no content")}}