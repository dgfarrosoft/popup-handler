function PopupHandler(){return this instanceof PopupHandler?(this.triggerAttribute="data-popup",this.contentAttribute="data-content",this.getFromPage=[],this.popupVisible=!1,this.additionalDataAttributes=[],this.deferredTriggerAttribute="data-deferred-popup",this.disabledFormClass="js-disabled",this.popupClass="b-popup",this.popupWrapperClass=this.popupClass+"__wrapper",this.popupCloseSelector="[data-popup-close]",this.popupContents={},this.popupHandlers={},this.focusOnFirstInput=!0,this.closeOnWrapperClick=!0,this.ajaxUrl="",this.ajaxRequestData={},this.animatedShow=!0,this.popupShowSpeed=200,this.backgroundTransition=!0,this.backgroundTransitionSpeed=1e3,this.darkBackground=!1,this.ajaxAction="ajaxGetPopupContent",this.popupStyles="background-color:transparent;text-align:center;position:fixed;z-index:100;display:none;height: 100%;width: 100%;left:0;top:0;",this.init=function(t){if(void 0!==t)for(var p in t)this[p]=t[p];this.getPopupsContent(),this.injectPopup(),this.setPopupStyles(),this.initEventListeners()},this.getPopupsContent=function(){var t=this,p=this.getAjaxRequestData(),i=this.isEqual(p,this.ajaxRequestData);this.ajaxRequestData=p,0===Object.keys(p.popupRequestData).length||""==this.ajaxUrl||i||jQuery.ajax({url:this.ajaxUrl,type:"POST",data:p,success:function(p){if("no content"!=p){p=jQuery.parseJSON(p);for(var i in p)t.popupContents[i]={popupID:p[i].popupID,content:p[i].content}}else console.log(p)},error:function(t){console.log(t)}})},this.fillPopup=function(t){var p=this;this.popup.html(this.popupContents[t].content),this.getPopupsContent(),void 0!==this.popupHandlers[t]&&"function"==typeof this.popupHandlers[t]&&jQuery("form#"+this.popupContents[t].popupID).submit(function(i){i.preventDefault();var s=jQuery(this);s.hasClass(p.disabledFormClass)||p.formSubmission(p,t,s)})},this.formSubmission=function(t,p,i){this.popupHandlers[p](i,t)},this.showPopup=function(t,p){if("string"!=typeof t){p=void 0===p?!1:p;var i=p?this.deferredTriggerAttribute:this.triggerAttribute;t=t.attr(i)}this.hidePopup(!0),void 0!==this.popupContents[t]?""!=this.popupContents[t].popupID&&(this.fillPopup(t),this.popupVisible=!0,jQuery(document).trigger("popup-show",[this.popup]),this.popupWrapper.show(),this.centerVertically(),void 0!==this.customWrapperBackground?this.popupWrapper.css("background-color",this.customWrapperBackground):this.darkBackground?this.popupWrapper.css("background-color","rgba(1, 1, 1, .7)"):this.popupWrapper.css("background-color","rgba(207, 207, 207, .6)"),this.focusOnFirstInput&&this.popup.find("input").eq(0).focus()):(console.log("showPopup"),console.log(t))},this.hidePopup=function(){this.popupWrapper.css("-webkit-transition","none"),this.popupWrapper.css("transition","none"),this.popupWrapper.css("padding-top",0),this.popupWrapper.hide(),this.popup.html(""),this.setPopupStyles(),this.popupVisible||this.popupWrapper.css("background-color","transparent"),this.popupVisible=!1},this.getSingleAjaxRequestData=function(t,p){void 0===p&&(p={});var i,s=0;if(0!=this.additionalDataAttributes.length)for(var e=0;e<this.additionalDataAttributes.length;e++)i=t.attr(this.additionalDataAttributes[e]),void 0!==i&&(p=0==p?{}:p,p[this.additionalDataAttributes[e]]=i,s++),e==this.additionalDataAttributes.length-1&&0==s&&(p=0);else p=0;return p},this.getAjaxRequestData=function(){var t={action:this.ajaxAction,popupRequestData:{}},p=jQuery("["+this.triggerAttribute+"]"),i=jQuery("["+this.deferredTriggerAttribute+"]");return t=this.fillRequestData(p,t),t=this.fillRequestData(i,t,!0)},this.fillRequestData=function(t,p,i){void 0===i&&(i=!1);for(var s,e,o=i?this.deferredTriggerAttribute:this.triggerAttribute,n=0;n<t.length;n++)e=jQuery(t[n]),s=e.attr(o),void 0!=s&&-1===this.getFromPage.indexOf(s)?p.popupRequestData[s]=this.getSingleAjaxRequestData(e,p.popupRequestData[s]):-1!==this.getFromPage.indexOf(s)&&(this.popupContents[s]={popupID:s,content:$("["+this.contentAttribute+"="+s+"]").html()});return p},this.updateContent=function(t,p){if(void 0!==this.popupContents[t]){var i=document.createElement("div");i.innerHTML=this.popupContents[t].content;var s=jQuery(i);jQuery.each(p,function(t,p){p(s.find(t),s)}),this.popupContents[t].content=i.innerHTML}else console.log("no content")},this.injectPopup=function(){0==jQuery("."+this.popupClass).length&&jQuery("body").append('<div class = "'+this.popupWrapperClass+'"><div class = "'+this.popupClass+'__close-btn"></div><div class = "'+this.popupClass+'"></div></div>'),this.popup=jQuery("."+this.popupClass),this.popupWrapper=this.popup.closest("."+this.popupWrapperClass)},this.initEventListeners=function(){var t=this;jQuery(document).on("click","["+this.triggerAttribute+"]",function(p){p.preventDefault(),t.showPopup(jQuery(this).attr(t.triggerAttribute)),jQuery(t.popupCloseSelector).click(function(){t.hidePopup()}),t.closeOnWrapperClick&&jQuery(document).click(function(p){jQuery(p.target).hasClass(t.popupWrapperClass)&&t.hidePopup()})})},this.centerVertically=function(t){var p=this.popupWrapper,i=(p.outerHeight()-this.popup.outerHeight())/2;p.css("padding-top",i)},this.isEqual=function(t,p){return JSON.stringify(t)===JSON.stringify(p)},this.setPopupStyles=function(){var t=[];this.popupWrapper.attr("style",this.popupStyles),this.animatedShow&&t.push("padding "+this.popupShowSpeed/1e3+"s"),this.backgroundTransition&&t.push("background-color "+this.backgroundTransitionSpeed/1e3+"s"),t=t.join(","),""!=t&&this.popupWrapper.css("transition",t)},void 0):new PopupHandler}