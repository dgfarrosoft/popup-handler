function PopupHandler(){return this instanceof PopupHandler?(this.triggerAttribute="data-popup",this.allElementsAtOnce=!1,this.hashAttribute="data-hash",this.deferredTriggerAttribute="data-deferred-popup",this.contentAttribute="data-content",this.additionalDataAttributes=[],this.getFromPage=[],this.popupClass="b-popup",this.popupWrapperClass=this.popupClass+"__wrapper",this.popupCloseButtonClass=this.popupClass+"__close-btn",this.popupCloseSelectors=["[data-popup-close]","."+this.popupCloseButtonClass],this.disabledFormClass="js-disabled",this.popupHandlers={},this.popupVisible=!1,this.popupContents={},this.focusOnFirstInput=!0,this.closeOnWrapperClick=!0,this.ajaxUrl="",this.ajaxRequestData={},this.animatedShow=!0,this.popupShowSpeed=200,this.backgroundTransition=!0,this.backgroundTransitionSpeed=1e3,this.darkBackground=!1,this.ajaxAction="",this.ajaxDataObjectName="popupRequestData",this.customWrapperBackground="",this.closeButtonSize="40px",this.closeButtonColor="#000",this.popupStyles="max-width: 400px;margin: 0 auto;background: white;padding: 30px;border-radius: 3px;",this.popupWrapperStyles="background:transparent;position:fixed;z-index:100;display:none;height: 100%;width: 100%;left:0;top:0;",this.popupCloseImage='<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 371.23 371.23" style="enable-background:new 0 0 371.23 371.23;" xml:space="preserve"><polygon points="371.23,21.213 350.018,0 185.615,164.402 21.213,0 0,21.213 164.402,185.615 0,350.018 21.213,371.23 185.615,206.828 350.018,371.23 371.23,350.018 206.828,185.615 "/><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g></svg>',this.popupCloseBtnStyles="width: "+this.closeButtonSize+";height: "+this.closeButtonSize+";position: absolute;right: 2%;top: 2%;cursor: pointer;",this.init=function(t){if(void 0!==t)for(var e in t)this[e]=t[e];this.getPopupsContent(this.allElementsAtOnce),this.injectPopup(),this.popupCloseBtn=jQuery("."+this.popupCloseButtonClass),this.setPopupStyles(),this.initEventListeners(this.allElementsAtOnce)},this.getPopupsContent=function(){var t=this;this.setPopupAttributes();var e=this.getAjaxRequestData();if(this.allElementsAtOnce){var s=this.isEqual(e,this.ajaxRequestData);this.ajaxRequestData=e,0===Object.keys(e[this.ajaxDataObjectName]).length||""===this.ajaxUrl||s||jQuery.ajax({url:t.ajaxUrl,type:"POST",data:e,success:function(e){if("no content"!==e){e=jQuery.parseJSON(e);for(var s in e)t.popupContents[s]={popupID:e[s].formID,content:e[s].content},t.popupContents[s].popupID=void 0===t.popupContents[s].popupID?s:t.popupContents[s].popupID}else console.log(e)},error:function(t){console.log(t)}})}else{var p,i,o,a;jQuery.each(e[this.ajaxDataObjectName],function(e,s){a=s.element;var n=""!=t.ajaxAction?{action:t.ajaxAction}:{};n[t.ajaxDataObjectName]={},n[t.ajaxDataObjectName].popupID=s.popupID,n[t.ajaxDataObjectName].request=s.request,o=btoa(JSON.stringify(n)),void 0===t.popupContents[o]&&jQuery.ajax({url:t.ajaxUrl,type:"POST",data:n,success:function(e){console.log(e),"no content"!==e?(e=JSON.parse(e),p=void 0!==e.formID?e.formID:n[t.ajaxDataObjectName].popupID,i=void 0!==e.content?e.content:"",o=btoa(JSON.stringify(n)),t.popupContents[o]={popupID:p,content:i,element:a}):console.log(e)},error:function(t){console.log(t)}}),a.attr("data-hash",o)})}},this.fillPopup=function(t){var e=this,s=this.popupContents[t].popupID;this.popup.html(this.popupContents[t].content),this.getPopupsContent(),void 0!==this.popupHandlers[s]&&"function"==typeof this.popupHandlers[s]&&0!==jQuery("form#"+this.popupContents[t].popupID).length&&jQuery("form#"+this.popupContents[t].popupID).submit(function(t){t.preventDefault();var p=jQuery(this);p.hasClass(e.disabledFormClass)||e.formSubmission(e,s,p)})},this.formSubmission=function(t,e,s){this.popupHandlers[e](s,t)},this.showPopup=function(t,e){e=void 0===e?!1:e;var s;"string"!=typeof t&&(s=e?this.deferredTriggerAttribute:this.triggerAttribute,t=t.attr(s)),this.allElementsAtOnce&&(t=t.attr(this.hashAttribute)),this.hidePopup(),void 0!==this.popupContents[t]?""!==this.popupContents[t].popupID&&(this.fillPopup(t),this.popupVisible=!0,jQuery(document).trigger("popup-show",[this.popup]),jQuery("body").css("overflow","hidden"),this.popupWrapper.show(),this.centerVertically(),""!==this.customWrapperBackground?this.popupWrapper.css("background",this.customWrapperBackground):this.darkBackground?this.popupWrapper.css("background","rgba(1, 1, 1, .7)"):this.popupWrapper.css("background","rgba(207, 207, 207, .6)"),this.focusOnFirstInput&&this.popup.find("input").eq(0).focus()):(console.log("showPopup"),console.log(t),console.log(this.popupContents))},this.hidePopup=function(){this.popupWrapper.css("-webkit-transition","none"),this.popupWrapper.css("transition","none"),this.popupWrapper.css("padding-top",0),this.popupWrapper.hide(),this.popup.html(""),jQuery("body").css("overflow","visible"),this.setPopupStyles(),this.popupVisible||this.popupWrapper.css("background","transparent"),this.popupVisible=!1},this.getSingleAjaxRequestData=function(t,e){void 0===e&&(e={});var s,p=0;if(0!==this.additionalDataAttributes.length)for(var i=0;i<this.additionalDataAttributes.length;i++)s=t.attr(this.additionalDataAttributes[i]),void 0!==s&&(e=0===e?{}:e,e[this.additionalDataAttributes[i]]=s,p++),i===this.additionalDataAttributes.length-1&&0===p&&(e=0);else e=0;return e},this.getAjaxRequestData=function(){var t={};t[this.ajaxDataObjectName]=this.allElementsAtOnce?{}:[],""!==this.ajaxAction&&(t.action=this.ajaxAction);var e=jQuery("["+this.triggerAttribute+"]"),s=jQuery("["+this.deferredTriggerAttribute+"]");return t=this.fillRequestData(e,t),t=this.fillRequestData(s,t,!0)},this.fillRequestData=function(t,e,s){void 0===s&&(s=!1);for(var p,i,o=s?this.deferredTriggerAttribute:this.triggerAttribute,a=0;a<t.length;a++)i=jQuery(t[a]),p=i.attr(o),void 0!==p&&-1===this.getFromPage.indexOf(p)?this.allElementsAtOnce?e[this.ajaxDataObjectName][p]=this.getSingleAjaxRequestData(i,e[this.ajaxDataObjectName][p]):e[this.ajaxDataObjectName].push({popupID:p,element:i,request:this.getSingleAjaxRequestData(i,e[this.ajaxDataObjectName][p])}):-1!==this.getFromPage.indexOf(p)&&(this.popupContents[p]={popupID:p,content:jQuery("["+this.contentAttribute+"="+p+"]").html()});return e},this.updateContent=function(t,e){if(void 0!==this.popupContents[t]){var s=document.createElement("div");s.innerHTML=this.popupContents[t].content;var p=jQuery(s);jQuery.each(e,function(t,e){e(p.find(t),p)}),this.popupContents[t].content=s.innerHTML}else console.log("no content")},this.injectPopup=function(){var t='<div class = "'+this.popupCloseButtonClass+'">'+this.popupCloseImage+"</div>";0===jQuery("."+this.popupClass).length&&jQuery("body").append('<div class = "'+this.popupWrapperClass+'">'+t+'<div class = "'+this.popupClass+'"></div></div>'),this.popup=jQuery("."+this.popupClass),this.popupWrapper=this.popup.closest("."+this.popupWrapperClass)},this.setPopupAttributes=function(){if(void 0!==this.triggerSelectors){var t;for(var e in this.triggerSelectors)t=this.triggerSelectors[e].join(","),jQuery(t).attr(this.triggerAttribute,e)}},this.initEventListeners=function(){var t,e=this;jQuery(document).on("click","["+this.triggerAttribute+"]",function(s){s.preventDefault(),t=e.allElementsAtOnce?e.triggerAttribute:"data-hash",e.showPopup(jQuery(this).attr(t)),"string"==typeof e.popupCloseSelectors&&(e.popupCloseSelectors=[e.popupCloseSelectors]),jQuery(e.popupCloseSelectors.join(",")).click(function(){e.hidePopup()}),e.closeOnWrapperClick&&jQuery(document).click(function(t){jQuery(t.target).hasClass(e.popupWrapperClass)&&e.hidePopup()})})},this.popupTriggerCallback=function(t){var e=this;return function(){e.showPopup(t)}},this.centerVertically=function(t){var e=this.popupWrapper,s=(e.outerHeight()-this.popup.outerHeight())/2;e.css("padding-top",s)},this.isEqual=function(t,e){return JSON.stringify(t)===JSON.stringify(e)},this.setPopupStyles=function(){var t=[];this.popupWrapper.attr("style",this.popupWrapperStyles),this.popup.attr("style",this.popupStyles),this.popupCloseBtn.attr("style",this.popupCloseBtnStyles),this.popupCloseBtn.css("fill",this.closeButtonColor),this.animatedShow&&t.push("padding "+this.popupShowSpeed/1e3+"s"),this.backgroundTransition&&t.push("background "+this.backgroundTransitionSpeed/1e3+"s"),t=t.join(","),""!==t&&this.popupWrapper.css("transition",t)},void 0):new PopupHandler}